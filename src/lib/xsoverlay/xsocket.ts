import WebSocket from '@tauri-apps/plugin-websocket';
import { toast } from 'svelte-sonner';
import type { XSNotification } from '$lib/xsoverlay/xsNotification';
import { getNumericSetting, getSetting } from '$lib/store';
import { type XSObject } from '$lib/xsoverlay/xsObject';

let xsocket: WebSocket;

const icon: string =
	'iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFyWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDIgNzkuNzhiNzYzOCwgMjAyNS8wMi8xMS0xOToxMDowOCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIiB4bWxuczpwaG90b3Nob3A9Imh0dHA6Ly9ucy5hZG9iZS5jb20vcGhvdG9zaG9wLzEuMC8iIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI2LjUgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyNS0wNS0zMVQxNDo0MDoyNS0wNDowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyNS0wNS0zMVQxNDo0MDoyNS0wNDowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjUtMDUtMzFUMTQ6NDA6MjUtMDQ6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ODVkMjJjZTgtZWM2NS03MzQ5LWEyZGQtZjNlZmVjNDVhNTVlIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NmY3ZDA4ZjEtZDEzNS03NjRhLWIzNjMt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';

export async function createSocket() {
	const xsEnabled = await getSetting('xsOverlayEnabled');
	if (xsEnabled) {
		const xsP = await getNumericSetting('xsOverlayPort');
		const port: number = xsP || 42070;
		const address = `ws://localhost:${port}/?client=Spectre`;
		try {
			xsocket = await WebSocket.connect(address);
			console.log('Connected to XSOverlay');
		} catch (e) {
			console.error('Could not connect to XSOverlay, is XSO running?');
		}
	}
}

export async function disableXsOverlay() {
	if (xsocket) await xsocket.disconnect();
}

export async function sendXsNotification(msg: string) {
	const xsEnabled = await (getSetting('xsOverlayEnabled'));

	if (!xsEnabled) return;

	if (!xsocket) {
		await createSocket();
	}

	let notification: XSNotification = {
		type: 1,
		timeout: 3,
		height: 175,
		opacity: 0.85,
		volume: 0,
		title: 'SPECTRE',
		content: msg,
		useBase64Icon: true,
		icon: icon,
		sourceApp: 'Spectre 2.0'
	};

	let notificationJson = JSON.stringify(notification);

	let xsObj: XSObject = {
		sender: 'Spectre',
		target: 'xsoverlay',
		command: 'SendNotification',
		jsonData: notificationJson,
		rawData: ''
	}

	try {
		await xsocket.send(JSON.stringify(xsObj));
	} catch (e) {
		console.error('Could not send notification to XSOverlay!');
		// toast.error('Could not send notification to XSOverlay, please double check your settings.');
	}
}
